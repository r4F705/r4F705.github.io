<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="article.css">
  <link href="../prism.css" rel="stylesheet" />
  <title>Hacking Blog - Article Title</title>
</head>

<body>
  <header>
    <div class="logo">Hacking Blog</div>
    <nav>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </nav>
  </header>

  <div class="article-container">
    <h1 class="article-title">Insecure JWT Token Generation in Annotator Tool (CVE-2023-1712)</h1>
    <div class="article-meta">Published on <span class="article-date">Mar 22nd, 2023</span> by <span
        class="article-author">r4f705</span></div>

    <div class="article-content">
      <h3>Introduction</h3>
      <p>The purpose of this disclosure is to ethically report a web vulnerability found in the Annotator Tool. By
        analyzing the provided docker image, it was possible to gain access to the source code and identify a critical
        security flaw related to the generation of JSON Web Tokens (JWTs). This vulnerability allows low-level users to
        escalate their privileges and perform actions that were previously restricted.</p>

      <h3>Vulnerability Details</h3>
      <p>The vulnerability stems from a hardcoded value found in the configuration file config/config.production.js.
        Specifically, the value of config.jwt.secret = Hm************tA is used to sign JWT tokens. Exploiting this
        weakness enables an attacker to create new JWT tokens with the "super_admin" role, granting unauthorized access
        and privileges.</p>

      <h3>Exploitation Method</h3>
      <p>
        To exploit this vulnerability, the attacker needs to replicate the token generation process used by the
        application. This can be achieved by modifying the existing back-end code of the annotation tool. The following
        lines can be added to the getSignedJWT function in app/service/userService.js:
      </p>

      <pre>
        <code class="language-javascript">
          const fs = require('fs');

          let x = this.app.jwt.sign(
            {
              id: 2,
              email: "r4F705@proxy.com",
              role: "super_admin",
            },
            "Hm************tA"
          );

          fs.writeFile('/tmp/test.txt', x, err => {
            if (err) {
              console.error(err);
            }
          });
        </code>
      </pre>

      <p>By incorporating this code snippet into a modified version of the back-end, the attacker can host a local
        instance of the application. Logging in with a regular user account on the modified instance will generate a new
        JWT token with the "super_admin" role. To utilize this forged token, the attacker can retrieve it from
        /tmp/test.txt within the running container or the host system. Then, by updating the value of the "dpst-token"
        found in the browser's local storage for the original login domain, the attacker can assume the elevated
        privileges associated with the "super_admin" role.
      </p>

      <figure>
        <img src="../images/haystack-proof.png" class="article-image" />
        <figcaption>Logged in as super admin</figcaption>
      </figure>

      <br />
      <h3>Impact</h3>
      <p>
        This vulnerability has significant implications for all current versions of the annotation tool, regardless of
        whether they are hosted online or within a company's internal network. Since the containers utilized by the tool
        share the same secret key, any forged tokens created using the vulnerability will be effective across all
        instances of the tool.
      </p>

      <p>
        The impact of this vulnerability is twofold, affecting both the integrity and availability of the tool and its
        associated data. Exploiting the vulnerability allows an attacker to gain super admin access without the need for
        a valid account, posing a severe security risk. With super admin privileges, an attacker can masquerade as any
        other user, leading to unauthorized modifications to the annotation process and the potential corruption of
        valuable training data for QA models. As a result, the reliability and trustworthiness of the annotation tool's
        outputs are compromised.
      </p>

      <p>
        Furthermore, an attacker can leverage scripted attacks to remove created users, significantly impeding the
        functionality and usability of the tool. The removal of user accounts can disrupt workflows and impede
        collaboration, rendering the tool's usage challenging and hindering productivity.
      </p>

      <p>
        Originaly reported on <a href="https://huntr.dev/bounties/9a6b1fb4-ec9b-4cfa-af1e-9ce304924829/">huntr</a>
      </p>

    </div>

    <a href="../index.html" class="back-link">‚Üê Back to Home</a>
  </div>

  <footer>
    <div class="social-icons">
      <a href="https://huntr.dev/users/r4f705/" target="_blank">Huntr</a>
    </div>
    <p>&copy; 2023 Hacking Blog. All rights reserved.</p>
  </footer>

  <script src="../prism.js"></script>
</body>

</html>